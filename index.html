<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text to HTML - Strict Single Spacing</title>

<style>
  /* --- TOOL UI --- */
  :root { --bg: #eef2f7; --card: #ffffff; --border: #d6dbe4; --text: #1f2937; --accent: #5b7cfa; }
  body { margin: 0; padding: 40px 20px; font-family: "Segoe UI", sans-serif; background: var(--bg); color: var(--text); }
  .container { max-width: 960px; margin: 0 auto; }
  
  .page-header { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: var(--text); }
  .page-header span { color: var(--accent); }

  .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 20px; }
  .toolbar { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; }
  .toolbar button { border: 1px solid var(--border); background: #fff; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
  .editor { min-height: 200px; border: 1px solid var(--border); border-radius: 8px; padding: 16px; background: #fbfcff; outline: none; font-size: 16px; line-height: 1.5; color: #000; }
  .actions { display: flex; justify-content: space-between; margin-top: 16px; align-items: center; }
  .buttons button { background: var(--accent); color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }
  .buttons button.secondary { background: #0f172a; }
  .buttons button.copied { background: #22c55e; }
  label { font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px; cursor: pointer; }
  pre { margin-top: 20px; background: #1e293b; color: #e5e7eb; padding: 20px; border-radius: 12px; font-size: 12px; white-space: pre-wrap; word-break: break-all; }
</style>
</head>
<body>

<div class="container">
  
  <div class="page-header"><span>Text to HTML</span> for Email</div>

  <div class="card">
    <div class="toolbar">
      <button onclick="cmd('bold')"><b>B</b></button>
      <button onclick="cmd('italic')"><i>I</i></button>
      <button onclick="cmd('underline')"><u>U</u></button>
      <button onclick="cmd('insertUnorderedList')">• List</button>
      <button onclick="cmd('insertOrderedList')">1. List</button>
      <button onclick="addLink()">Link</button>
    </div>

    <div id="editor" class="editor" contenteditable="true"></div>

    <div class="actions">
      <label><input type="checkbox" id="addSeparator"> Add Separator</label>
      <div class="buttons">
        <button onclick="convert()">Convert</button>
        <button id="copyBtn" class="secondary" onclick="copyHTML()">Copy HTML</button>
      </div>
    </div>
  </div>
  <pre id="output">Output will appear here...</pre>
</div>

<script>
const editor = document.getElementById("editor");
const output = document.getElementById("output");

function cmd(c) { document.execCommand(c, false, null); editor.focus(); }
function addLink() { const u = prompt("Enter URL:"); if (u) document.execCommand("createLink", false, u); }

function convert() {
  try {
    let h = editor.innerHTML;

    // --- STEP 1: JUNK & INVISIBLE CHAR KILLER ---
    // Remove invisible "newline" characters that cause gaps in MVD
    h = h.replace(/(\r\n|\n|\r)/gm, "");
    
    // Remove styles/classes
    h = h.replace(/ style="[^"]*"/gi, "");
    h = h.replace(/ class="[^"]*"/gi, "");
    h = h.replace(/<\/?span[^>]*>/gi, "");

    // --- STEP 2: LOGICAL FLATTENING (The Fix) ---
    // Instead of replacing <div> with <br> (Start), we replace </div> with <br> (End)
    // This ensures lines stack correctly without top-margin gaps.
    
    // 1. Convert closing tags to Breaks
    h = h.replace(/<\/div>/gi, "<br>");
    h = h.replace(/<\/p>/gi, "<br>");
    
    // 2. Remove opening tags completely (Clean start)
    h = h.replace(/<div[^>]*>/gi, "");
    h = h.replace(/<p[^>]*>/gi, "");
    
    // 3. Prevent Triple Breaks (Max 2 allowed)
    h = h.replace(/(<br\s*\/?>){3,}/gi, "<br><br>"); 
    
    // 4. Remove Trailing Breaks at the very end of string
    h = h.replace(/(<br\s*\/?>)+$/gi, "");

    // --- STEP 3: MVD GAP KILLER ---
    // Remove &nbsp; before <br> to prevent "Double Height" lines
    h = h.replace(/(&nbsp;| )+<br>/gi, "<br>");

    // --- STEP 4: FORMATTING & LINKS ---
    h = h.replace(/<a\s+[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, 
      '<a href="$1" style="color:#0067B8; text-decoration:underline;">$2</a>'
    );
    h = h.replace(/ {2,}/g, m => " " + "&nbsp;".repeat(m.length - 1));

    // --- STEP 5: THE STRICT TEMPLATE ---
    // Added 'mso-line-height-rule: exactly' to force 24px height
    const mainTemplate = `
<table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#ffffff" align="center" class="mobile-side-padding-20"
 style="font-family:'Segoe UI', SUWR, Verdana, sans-serif; font-size:16px; mso-line-height-rule: exactly; line-height:24px; color:#000000; padding:40px 30px; text-align:left; letter-spacing:0.0em;">
ENTER YOUR CUSTOM TEXT HERE
</td></tr></tbody></table> 
`;

    const separatorTemplate = `
<table border="0" cellpadding="0" cellspacing="0" width="100%"> <tbody><tr> <td bgcolor="#ffffff" style="padding:0 30px;" class="mobile-side-padding-20"> <table width="100%" cellspacing="0" cellpadding="0" border="0"> <tbody><tr> <td height="1" bgcolor="#ffffff" style="line-height:1px; mso-line-height-rule: exactly; font-size:1px; border-top:1px solid #A2A2A2;"></td> </tr> </tbody></table> </td> </tr></tbody></table> `;

    let finalCode = mainTemplate.replace("ENTER YOUR CUSTOM TEXT HERE", h);

    if (document.getElementById("addSeparator").checked) {
      finalCode += "\n" + separatorTemplate.trim();
    }

    output.textContent = finalCode.trim();
  } catch (err) { alert("Error: " + err.message); }
}

function copyHTML() {
  const text = output.textContent;
  if (!text || text.includes("Output will appear")) return;
  if (navigator.clipboard) { navigator.clipboard.writeText(text).then(showSuccess).catch(() => fallbackCopy(text)); } 
  else { fallbackCopy(text); }
}

function fallbackCopy(text) {
  const ta = document.createElement("textarea");
  ta.value = text; ta.style.position = "fixed"; ta.style.left = "-9999px";
  document.body.appendChild(ta); ta.select();
  try { document.execCommand('copy'); showSuccess(); } catch (e) { alert("Manual copy required."); }
  document.body.removeChild(ta);
}

function showSuccess() {
  const b = document.getElementById("copyBtn");
  const old = b.textContent;
  b.textContent = "Copied ✓"; b.classList.add("copied");
  setTimeout(() => { b.textContent = old; b.classList.remove("copied"); }, 2000);
}
</script>

</body>
</html>
